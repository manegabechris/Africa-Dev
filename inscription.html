<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Formulaire d'inscription Africa Dev - Créez votre compte pour accéder à nos formations en ligne.">
  <meta name="keywords" content="inscription, formulaire, création de compte, formation en ligne">
  <meta name="author" content="Africa Dev Team">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://yoursite.com/inscription.html">
  <!-- Open Graph -->
  <meta property="og:title" content="Inscription - Africa Dev">
  <meta property="og:description" content="Rejoignez Africa Dev et commencez votre parcours de formation digitale.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yoursite.com/inscription.html">
  <meta property="og:image" content="https://yoursite.com/og-image.jpg">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Inscription Africa Dev">
  <meta name="twitter:description" content="Créez votre compte pour accéder aux formations.">
  <title>Formulaire d'inscription</title>
  <link rel="stylesheet" href="Styles.CSS">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Inscription - Africa Dev",
    "description": "Formulaire d'inscription pour rejoindre Africa Dev",
    "url": "https://yoursite.com/inscription.html"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Inscription - Africa Dev",
    "description": "Formulaire d'inscription pour rejoindre Africa Dev",
    "url": "https://yoursite.com/inscription.html"
  }
  </script>
</head>
<body>
  <div class="container">
    <h3>Formulaire d'inscription</h3>
    <h4>Veuillez remplir les champs ci-dessous</h4>

    <form id="signupForm" action="option.html" method="post" novalidate>

      <fieldset>
        <label for="username">Nom d'utilisateur</label>
        <input type="text" id="username" name="username" placeholder="Choisissez un nom d'utilisateur" required>
        <small class="error" id="usernameError"></small>

        <label for="name">Nom complet</label>
        <input type="text" id="name" name="nom" placeholder="Votre nom complet" required>
        <small class="error" id="nameError"></small>

        <label for="mobile">N° téléphone</label>
        <input type="tel" id="mobile" name="mobile" placeholder="+243..." required pattern="\+?\d{7,15}">
        <small class="error" id="mobileError"></small>

        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="Votre adresse email" required>
        <small class="error" id="emailError"></small>

        <label for="password">Mot de passe</label>
        <input type="password" name="password" id="password" placeholder="Mot de passe (min 8 caractères, au moins une lettre et un chiffre)" required>
        <small class="error" id="passwordError"></small>

        <label for="confirmPassword">Confirmer le mot de passe</label>
        <input type="password" name="confirmPassword" id="confirmPassword" placeholder="Confirmez le mot de passe" required>
        <small class="error" id="confirmPasswordError"></small>

        <label><input type="checkbox" id="showPassword"> Afficher le mot de passe</label>
      </fieldset>

      <fieldset>
        <label for="dob">Date de naissance</label>
        <input type="date" id="dob" name="dob" required>
        <small class="error" id="dobError"></small>

        <label for="address">Adresse</label>
        <input type="text" id="address" name="address" placeholder="Votre adresse complète">
      </fieldset>

      <fieldset>
        <label>Sexe</label>
        <div class="radio-group">
          <label><input type="radio" name="sexe" value="masculin"> Masculin</label>
          <label><input type="radio" name="sexe" value="féminin"> Féminin</label>
        </div>
      </fieldset>

      <fieldset>
        <label>Langues parlées</label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="langue[]" value="français"> Français</label>
          <label><input type="checkbox" name="langue[]" value="anglais"> Anglais</label>
          <label><input type="checkbox" name="langue[]" value="espagnol"> Espagnol</label>
          <label><input type="checkbox" name="langue[]" value="italien"> Italien</label>
          <label><input type="checkbox" name="langue[]" value="portugais"> Portugais</label>
        </div>
      </fieldset>

      <fieldset>
        <label for="country">Pays de résidence</label>
        <select name="country" id="country">
          <option value="">-- Sélectionnez un pays --</option>
          <option value="RDC">RDC</option>
          <option value="RWANDA">Rwanda</option>
          <option value="BURUNDI">Burundi</option>
          <option value="TANZANIE">Tanzanie</option>
          <option value="KENYA">Kenya</option>
        </select>
      </fieldset>

      <fieldset>
        <label><input type="checkbox" id="terms" required> J'accepte les <button type="button" id="openPolicyBtn" class="nav-cta">conditions d'utilisation et la politique de confidentialité</button></label>
        <small class="error" id="termsError"></small>
      </fieldset>

      <!-- Privacy Policy Modal (inline; page removed from navigation) -->
      <div id="policyModal" class="modalOverlay" aria-hidden="true" role="dialog" aria-labelledby="policyTitle">
        <div class="modal" role="document">
          <div class="modalHeader">
            <h2 id="policyTitle">Politique de confidentialité</h2>
            <button class="closeBtn" id="closePolicyBtn" aria-label="Fermer">×</button>
          </div>
          <div class="modalBody" style="max-height:48vh;overflow:auto;color:#0b1220;">
            <div class="container">
              <p>Chez Africa Dev, nous attachons une importance capitale à la confidentialité de vos données. Nous collectons des informations personnelles pour vous offrir une expérience personnalisée et sécurisée (nom, email, téléphone, etc.).</p>
              <h3>Utilisation des données</h3>
              <p>Nous utilisons ces données pour améliorer nos services, vous tenir informé·e des actualités et garantir la sécurité de la plateforme. Nous ne partageons pas vos données sans consentement, sauf si la loi l'exige.</p>
              <h3>Vos droits</h3>
              <p>Vous pouvez accéder, rectifier ou demander la suppression de vos données. Contactez-nous si nécessaire.</p>
              <p><em>Cette version est une synthèse rapide de la politique complète qui était auparavant disponible sur la page de confidentialité.</em></p>
            </div>
          </div>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button id="acceptPolicyBtn" class="btn">Accepter</button>
            <button id="dismissPolicyBtn" class="closeBtn">Fermer</button>
          </div>
        </div>
      </div>

      <input type="submit" value="Créer un compte" class="submit-btn">
      <div id="message" class="success hidden"></div>
    </form>

    <div class="footer-link">
        <button type="button" class="oauth-btn" onclick="loginGoogle()">Connexion avec Google</button>
        <button type="button" class="oauth-btn" onclick="loginGitHub()">Connexion avec GitHub</button> 
    </div>

    <script>
      // Make OAuth functions available early and redirect if already logged in
      function loginGoogle() {
        const mock = { username: 'google_user', name: 'Utilisateur Google', email: 'user@google.com' };
        localStorage.setItem('currentUser', JSON.stringify(mock));
        alert('Connexion Google simulée — redirection...');
        window.location.href = 'option.html';
      }
      function loginGitHub() {
        const mock = { username: 'github_user', name: 'Utilisateur GitHub', email: 'user@github.com' };
        localStorage.setItem('currentUser', JSON.stringify(mock));
        alert('Connexion GitHub simulée — redirection...');
        window.location.href = 'option.html';
      }
      (function checkAlreadyLoggedIn(){
        const cur = localStorage.getItem('currentUser');
        const messageEl = document.getElementById('message');
        const form = document.getElementById('signupForm');

        // If user already accepted privacy previously, reflect it
        if (localStorage.getItem('acceptedPrivacy') === 'true') {
          const termsEl = document.getElementById('terms');
          if (termsEl) termsEl.checked = true;
          if (messageEl && !messageEl.classList.contains('hidden')) { /* leave as-is */ }
        }

        if (cur) {
          const user = JSON.parse(cur);

          // keep the form visible but show a small message + logout button
          if (messageEl) {
            messageEl.style.display = 'block';
            messageEl.innerHTML = `Vous êtes connecté en tant que <strong>${user.name || user.username}</strong>.`;

            const btns = document.createElement('div');
            btns.style.marginTop = '12px';

            const logoutBtn = document.createElement('button');
            logoutBtn.textContent = 'Déconnexion';
            logoutBtn.style.cssText = 'margin-right:10px;padding:8px 10px;border-radius:6px;background:#e74c3c;color:#fff;border:none;cursor:pointer;font-size:14px';
            logoutBtn.addEventListener('click', () => {
              // immediate logout, reveal form remains visible
              localStorage.removeItem('currentUser');
              // update UI text
              messageEl.style.display = 'none';
              messageEl.textContent = '';
              // focus the first form input
              if (form) {
                const first = form.querySelector('input, select, textarea');
                if (first) first.focus();
              }
              // small toast
              if (typeof window.showToast === 'function') showToast('Vous êtes déconnecté.');
            });

            const continueBtn = document.createElement('button');
            continueBtn.textContent = 'Aller aux formations';
            continueBtn.style.cssText = 'padding:8px 10px;border-radius:6px;background:#3498db;color:#fff;border:none;cursor:pointer;font-size:14px';
            continueBtn.addEventListener('click', () => { window.location.href = 'option.html'; });

            btns.appendChild(logoutBtn);
            btns.appendChild(continueBtn);
            messageEl.appendChild(btns);
          }
        }
      })();

      // Policy modal controls
      const policyModal = document.getElementById('policyModal');
      const openPolicyBtn = document.getElementById('openPolicyBtn');
      const closePolicyBtn = document.getElementById('closePolicyBtn');
      const acceptPolicyBtn = document.getElementById('acceptPolicyBtn');
      const dismissPolicyBtn = document.getElementById('dismissPolicyBtn');
      const termsCheckbox = document.getElementById('terms');

      function openPolicy() {
        policyModal.classList.add('active');
        policyModal.setAttribute('aria-hidden', 'false');
      }
      function closePolicy() {
        policyModal.classList.remove('active');
        policyModal.setAttribute('aria-hidden', 'true');
      }

      if (openPolicyBtn) openPolicyBtn.addEventListener('click', openPolicy);
      if (closePolicyBtn) closePolicyBtn.addEventListener('click', closePolicy);
      if (dismissPolicyBtn) dismissPolicyBtn.addEventListener('click', closePolicy);

      if (acceptPolicyBtn) acceptPolicyBtn.addEventListener('click', function(){
        localStorage.setItem('acceptedPrivacy', 'true');
        if (termsCheckbox) termsCheckbox.checked = true;
        closePolicy();
        if (typeof window.showToast === 'function') showToast('Politique acceptée.');
      });

      // If user toggles the checkbox but hasn't accepted the policy yet, show the policy modal
      if (termsCheckbox) {
        termsCheckbox.addEventListener('change', function(e){
          if (this.checked && localStorage.getItem('acceptedPrivacy') !== 'true') {
            // force unchecked until they accept
            this.checked = false;
            openPolicy();
          }
        });
      }

      // If the page was opened from the old privacy page, open the modal
      if (location.search.indexOf('from=privacy') !== -1) {
        if (typeof setTimeout !== 'undefined') setTimeout(openPolicy, 250);
      }

      // Simple client-side validation and mock account creation
      const form = document.getElementById('signupForm');
      const message = document.getElementById('message');

      function showError(id, msg) {
        const el = document.getElementById(id);
        if (el) el.textContent = msg;
      }
      function clearErrors() {
        document.querySelectorAll('.error').forEach(e => e.textContent = '');
        message.style.display = 'none';
        message.textContent = '';
      }

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }
      function validatePhone(phone) {
        return /^\+?\d{7,15}$/.test(phone);
      }
      function validatePassword(pw) {
        return /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.test(pw);
      }

      document.getElementById('showPassword').addEventListener('change', function() {
        const type = this.checked ? 'text' : 'password';
        document.getElementById('password').type = type;
        document.getElementById('confirmPassword').type = type;
      });

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        clearErrors();
        let valid = true;

        const username = document.getElementById('username').value.trim();
        const name = document.getElementById('name').value.trim();
        const mobile = document.getElementById('mobile').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const dob = document.getElementById('dob').value;
        const terms = document.getElementById('terms').checked;

        if (!username) { showError('usernameError', 'Le nom d\'utilisateur est requis'); valid = false; }
        if (!name) { showError('nameError', 'Le nom complet est requis'); valid = false; }
        if (!mobile || !validatePhone(mobile)) { showError('mobileError', 'Numéro de téléphone invalide (ex: +243...)'); valid = false; }
        if (!email || !validateEmail(email)) { showError('emailError', 'Email invalide'); valid = false; }
        if (!password || !validatePassword(password)) { showError('passwordError', 'Le mot de passe doit contenir au moins 8 caractères, dont une lettre et un chiffre'); valid = false; }
        if (password !== confirmPassword) { showError('confirmPasswordError', 'Les mots de passe ne correspondent pas'); valid = false; }
        if (!dob) { showError('dobError', 'La date de naissance est requise'); valid = false; }
        if (!terms) { showError('termsError', 'Vous devez accepter les conditions'); valid = false; }

        if (!valid) return;

        // Mock users storage (replace with API calls in production)
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const existing = users.find(u => u.username === username || u.email === email);
        if (existing) {
          // If account exists, treat as login
          localStorage.setItem('currentUser', JSON.stringify(existing));
          message.style.display = 'block';
          message.textContent = 'Compte existant détecté — connexion en cours...';
          setTimeout(() => { window.location.href = 'option.html'; }, 1000);
          return;
        }

        const newUser = { username, name, mobile, email, dob, address: document.getElementById('address').value, country: document.getElementById('country').value };
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        // Définir l'utilisateur courant (session simulée)
        localStorage.setItem('currentUser', JSON.stringify({ username, name, email }));

        message.style.display = 'block';
        message.textContent = 'Compte créé avec succès ! Redirection...';

        setTimeout(() => {
          window.location.href = 'option.html';
        }, 1400);
      });


    </script>
  </div>

</body>
</html>
